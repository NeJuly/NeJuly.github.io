(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{569:function(t,s,n){"use strict";n.r(s);var e=n(4),p=Object(e.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("docker部署nginx+php的介绍很多，我也是安装上面的来部署，发现各种坑，在这给列举下，供大家参考。")]),t._v(" "),n("ol",[n("li",[t._v("安装好docker的nignx 和php"),n("br")]),t._v(" "),n("li",[t._v("修改nginx.conf配置，加上php解析"),n("br"),t._v("\n其中")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("location ~ .php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include fastcgi_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    fastcgi_param SCRIPT_FILENAME document_root\n    rootfastcgi_script_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    fastcgi_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.3:9000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#这里可以通过 docker inspect <容器名称> [| grep IpAddress] 查看")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#fastcgi_pass unix:/var/run/php5-fpm.sock;")]),t._v("\n    try_files "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("blockquote",[n("p",[t._v("出现502 gateway错误"),n("br"),t._v("\n这里的fastcgi_pass要是php-fpm容器的内网ip地址，而不是127.0.0.1 "),n("br")])]),t._v(" "),n("blockquote",[n("p",[t._v("出现404 file not found"),n("br"),t._v("\n其实nginx版本不同，document_root高版本已不支持，写成绝对路径，但大部署介绍写的是宿主机路径，这是错的。"),n("br"),t._v("\n要写成phpfpm容器内的路径，如：/var/www/html"),n("br"),t._v("\n还有我在安装phpfpm时挂载文件时-v宿主机要写到:后面"),n("br"),t._v("\n还碰到进容器后无权限，要在-v挂载后加–-privileged"),n("br"),t._v("\n有的说要去修改phpfpm的配置文件把listen 127.0.0.1改成0.0.0.0这是不需要的"),n("br"),t._v("\n以上应该就能访问通了"),n("br")])]),t._v(" "),n("p",[t._v("如果部署的时候有权限不足\n那要把宿主机对应的html文件夹设置成777")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("有的需要php特殊插件\nphp-fpm内有docker-php-ext-install命令"),n("br"),t._v("\n进入php-fpm容器内执行即可，如扩展mysql执行 docker-php-ext-install pdo pdo_mysql"),n("br")])]),t._v(" "),n("li",[n("p",[t._v("如果ext里面没有还可以用如下的")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" update "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件源")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y libwebp-dev libjpeg-dev libpng-dev libfreetype6-dev "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装各种库")]),t._v("\ndocker-php-source extract "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压源码")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/src/php/ext/gd "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gd源码文件夹")]),t._v("\ndocker-php-ext-configure gd --with-webp-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/include/webp --with-jpeg-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/include --with-png-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/include --with-freetype-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/include/freetype2 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#准备编译")]),t._v("\ndocker-php-ext-install gd "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译安装")]),t._v("\nphp -m "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" gd\n")])])]),n("p",[t._v('在所有环境都成功部署好后，有的在运行应用时，会出现"Primary script unknown"错误，一般这是由于nginx和php-fpm的'),n("code",[t._v("用户")]),t._v("不同导致的。"),n("br"),t._v("\n把nginx.conf和php-fpm.d/www.conf 的user设为同一个就可以了。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/golden_zjy/article/details/100046939",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=p.exports}}]);